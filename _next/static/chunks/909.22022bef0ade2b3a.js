"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[909],{1909:function(e,t,a){a.d(t,{Z:function(){return v}});var o=a(7437),r=a(2265),i=a(8124),s=a(3082),l=a(3321),n=a(1106),m=a(2079);function h(e,t,a){return e/1.9438444924574*Math.pow(t/10,a)*1.9438444924574}var c=a(3359),g=a(1378),u=a(262),p=new WeakMap,y=new WeakMap;class f{calcShape(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;(0,u._)(this,y,[]);let t=this.chordTackLevel/((0,c._)(this,p)[(0,c._)(this,p).length-1].x-(0,c._)(this,p)[0].x);for(let a of(0,c._)(this,p)){let o=a.clone().multiplyScalar(t);1!==e&&(o.y*=e),(0,c._)(this,y).push(o)}let a=new m.FM8(0,0);for(let e of(0,c._)(this,y))e.y>a.y&&(a=e);this.draftDepth=a.y,this.draftPosition=a.x,this.girth=0;let o=null;for(let e of(0,c._)(this,y))null!==o&&(this.girth+=e.distanceTo(o)),o=e;this.sag=this.chordTackLevel-this.girth,this.entryAngleRad=(0,c._)(this,y)[1].clone().sub((0,c._)(this,y)[0]).angle(),this.exitAngleRad=(0,c._)(this,y)[(0,c._)(this,y).length-1].clone().sub((0,c._)(this,y)[(0,c._)(this,y).length-2]).angle()-2*Math.PI,this.mastAngleRad=this.calcMastAngle(),this.forceAngleRad=(this.entryAngleRad+this.exitAngleRad)/2,this.draftDepthRatio=this.draftDepth/this.chordTackLevel,this.draftPositionRatio=this.draftPosition/this.chordTackLevel}calcMastAngle(){let e=0,t=null,a=this.mastWidth*this.chordTackLevel/this.chordMastTop;for(let o of(0,c._)(this,y)){if(null!==t&&(e+=o.distanceTo(t))>=a)return o.angle();t=o}return NaN}getVerticesAngles(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=(this.girth-t)/(e-1),r=0,i=0,s=[],l=null;for(let n of(0,c._)(this,y)){if(null!==l&&(((i+=n.distanceTo(l))>=r*o+t||a&&i>a)&&(r++,s.push(n.angle())),r>=e))break;l=n}return s}pointAtGirthDistance(e){let t=0,a=null;for(let o of(0,c._)(this,y))if(null!==a&&(t+=o.distanceTo(a)),a=o,t>=e)return a.clone()}constructor(e,t,a,o=1){(0,g._)(this,p,{writable:!0,value:void 0}),(0,g._)(this,y,{writable:!0,value:void 0}),(0,u._)(this,p,[]),(0,u._)(this,y,[]),this.chordMastTop=t,this.chordTackLevel=e,this.mastWidth=a;let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new m.FM8(t*e**2,2*t*e)},i=1.001+.95*(o-1)/10,s=(i-.001)/1e3,l=r(.001),n=r(i).clone().sub(l).angle(),h=new m.FM8(0,0);for(let e=.001;e<=i;e+=s){let t=r(e);t.sub(l),t.rotateAround(h,-n),(0,c._)(this,p).push(t)}this.calcShape(1-.25*(o-1)/10)}}let _=Math.floor(20),d=Math.ceil(160),M={waterlineToMastFootHeight:.45,maxMastRotation:Math.PI/2,maxChordRotationPerSailLevel:Math.PI/3*2};var b=e=>{let{windParams:t={speed:5,hellman:.27},boatParams:a={mastrotation:0,heading:130,speed:5},sailParams:i={mastArea:0,sailArea:0,cunningham:1,angleOfAttack:20}}=e,{getSignalKValue:l}=(0,s.yC)(),n=(0,r.useRef)(),c=(0,r.useRef)(null),g=(0,r.useRef)(0),u=(0,r.useRef)(null),p=(0,r.useRef)(null),y=(0,r.useRef)(),b=(0,r.useRef)({}),x=(0,r.useMemo)(()=>{let e=new m.ZAu,t=new m.b_z(.1,.2,12),a=new m.Wid({color:s.gK,opacity:.5,transparent:!0}),o=new m.Kj0(t,a);return o.position.set(0,-.1,0),e.add(o),e},[]);(0,r.useEffect)(()=>{let e=new m.ZAu,t={};for(let a=0;a<8;a+=.5){let o=x.clone();o.position.set(0,a,0),t[2*a]=o,e.add(o)}return e.position.set(0,0,0),y.current&&y.current.add(e),b.current=t,()=>{e.clear()}},[x]);let P=(e,t)=>{let a=b.current;if(!a){console.error("apparentWindField is not initialized.");return}for(let o=0;o<8;o+=.5){let r=h(e,o,t),i=a[2*o];if(!i){console.warn("Apparent wind field cone at height ".concat(o," is not defined."));continue}i.scale.set(.1*r,r,.1*r),i.rotation.set(0,-Math.PI,Math.PI/2)}},{geometry:j,sailClipWidthPerLevel:I}=(0,r.useMemo)(()=>{let e=new m.u9r,t=[],a=[],o=[];for(let e=0;e<=d;e++){let r,i;let s=Math.min(50*e,8e3);s<900?(r=3600,i=3800+-200*s/900):i=r=3600-3210*(s-900)/7100+600*Math.sin((s-900)/7100*Math.PI);let l=0;for(let o=0;o<_;o++){let n=r/(_-1),m=n*o-i,h=n;m>.1&&(h=m>n?0:n-m),t.push(0===o?0:(l+h)/1e3,s/1e3,0),l=0===o?0:l+h;let c=Math.floor(d/10);a.push(...e%c==0?[.8,0,.047]:[.596,.596,.596])}o.push(i===r?null:i)}let r=[];for(let e=0;e<d;e++)for(let t=1;t<_;t++){let a=e*_+t;r.push(a-1,a,a+_-1,a,a+_,a+_-1)}return e.setAttribute("position",new m.a$l(t,3)),e.setAttribute("color",new m.a$l(a,3)),e.setIndex(r),e.computeVertexNormals(),{geometry:e,sailClipWidthPerLevel:o}},[]),v=(0,r.useMemo)(()=>l("environment.wind.angleApparent")||0,[l]),w=(0,r.useMemo)(()=>l("environment.wind.speedApparent")||0,[l]);return(0,r.useEffect)(()=>{if(!n.current)return;P(w,t.hellman);let e=v>Math.PI&&v<=2*Math.PI,o=n.current.geometry,r=o.attributes.position.array;i.cunningham!==u.current&&(p.current=new f(3600,390,200,i.cunningham),u.current=i.cunningham),c.current||(c.current=o.clone());let s=1e3*M.waterlineToMastFootHeight,l=e?-1:1,y=m.M8C.degToRad(i.angleOfAttack),b=Math.abs(v),x=p.current.mastAngleRad;b<.01&&(y=0);let j=Math.min(b-y+x,M.maxMastRotation),A=new m.Pa4(0,1,0),R=null;for(let e=0;e<=d;e++){let a=Math.abs({awa:v,aws:h(w,(50*e+s)/1e3,t.hellman)}.awa)-y;a<0?a=0:a>Math.PI/2&&(a=Math.PI/2);let o=a-j;R&&o-R>M.maxChordRotationPerSailLevel&&(o=R+M.maxChordRotationPerSailLevel),R=o;let i=I[e],n=p.current.getVerticesAngles(_,200,i);for(let t=1;t<_;t++){let a=(e*_+t)*3,i=new m.Pa4(c.current.attributes.position.array[a],c.current.attributes.position.array[a+1],c.current.attributes.position.array[a+2]);i.applyAxisAngle(A,-(o+n[t])*l),r[a]=i.x,r[a+1]=i.y,r[a+2]=i.z}}o.attributes.position.needsUpdate=!0;let k={...a,mastrotation:j*l};n.current&&n.current.rotateY(g.current-k.mastrotation),g.current=k.mastrotation},[w,v,t.hellman,i.cunningham,i.angleOfAttack,a,I]),(0,o.jsxs)("mesh",{ref:n,position:[0,2,-1],rotation:[0,-Math.PI/2,0],children:[(0,o.jsx)("bufferGeometry",{...j}),(0,o.jsx)("group",{ref:y}),(0,o.jsx)("meshBasicMaterial",{vertexColors:!0,transparent:!0,opacity:.7,side:m.ehD})]})};let x=a(257).env.ASSET_PREFIX||"",P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return"".concat(x,"/boats/").concat(e,"/assets/scene-transformed.glb")},j={name:"Default",modelPath:"default",capabilities:["navigation","rudder","sail","color"]},I=(0,r.forwardRef)((e,t)=>{let{showSail:a=!1,...h}=e,c=(0,r.useRef)(),g=(0,r.useRef)(),{getSignalKValue:u}=(0,s.yC)(),p=l.Z.getAll(),[y,f]=(0,r.useState)(()=>l.Z.getSelectedBoat()||j);(0,r.useEffect)(()=>{f(l.Z.getSelectedBoat()||j)},[p]);let _=(0,r.useMemo)(()=>P(y.modelPath),[y]),d=(null==y?void 0:y.capabilities)||[],{nodes:M,materials:I}=(0,n.L)(_,"".concat(x,"/draco/")),v=(0,r.useMemo)(()=>({primaryColor:p.primaryColor,metallicEffect:p.metallicEffect||!1}),[p.primaryColor,p.metallicEffect]);(0,r.useEffect)(()=>{(null==I?void 0:I.fiberglass)&&(I.fiberglass.color.set(v.primaryColor),I.fiberglass.metalness=v.metallicEffect?1:0,I.fiberglass.roughness=v.metallicEffect?.2:1,Object.values(I).forEach(e=>{e.map&&(e.map.minFilter=m.wem,e.map.magFilter=m.wem,e.map.anisotropy=1)}))},[I,v]);let w=(0,r.useMemo)(()=>new m.yGw,[]),A=(0,r.useMemo)(()=>new m.Pa4(1,0,0),[]);(0,i.F)(()=>{if(!c.current)return;let e=u("navigation.attitude.roll")||0,t=u("steering.rudderAngle")||0;c.current.rotation.z!==e&&(c.current.rotation.z=e),g.current&&(w.makeRotationFromEuler(new m.USm(-Math.PI/2,Math.PI/2,0)),g.current.setRotationFromMatrix(w),g.current.rotateOnAxis(A,-m.M8C.degToRad(180*t/Math.PI)))});let R=(0,r.useMemo)(()=>{let e={Default:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("mesh",{geometry:M.baba_metal_0.geometry,material:I.metal,position:[.24,.895,-5.546],rotation:[-Math.PI/2,0,1.968],scale:.027}),(0,o.jsx)("mesh",{geometry:M.camadadirek_fiberglass_0.geometry,material:I.fiberglass,position:[0,5.267,-3.711],rotation:[2.054,0,Math.PI],scale:[-.042,.042,4.707]}),(0,o.jsx)("mesh",{geometry:M.camadanyelkeni_bez_0.geometry,material:I.mcaterial,position:[0,5.267,-3.711],rotation:[2.054,0,Math.PI],scale:[-.042,.042,4.707]}),(0,o.jsx)("mesh",{geometry:M.camadaonbaglay_metal_0.geometry,material:I.metal,position:[0,.891,-5.958],rotation:[-Math.PI/2,0,0],scale:.02}),(0,o.jsx)("mesh",{geometry:M.capa_metal_0.geometry,material:I.metal,position:[0,.671,-6.173],rotation:[-Math.PI/2,0,0],scale:.348}),(0,o.jsx)("mesh",{geometry:M.direk_fiberglass_0.geometry,material:I.fiberglass,position:[0,4.315,-1.056],rotation:[Math.PI/2,0,Math.PI],scale:[-.113,.113,5.203]}),(0,o.jsx)("mesh",{geometry:M.duman_ahsap_0.geometry,material:I.ahsap,position:[-.011,.854,3.487],rotation:[Math.PI,0,Math.PI/2],scale:[.045,.045,.011]}),(0,o.jsx)("mesh",{geometry:M.dumenyuvasi_ahsap_0.geometry,material:I.ahsap,position:[-.011,.299,3.441],rotation:[-Math.PI/2,0,1.571],scale:.094}),(0,o.jsx)("mesh",{geometry:M.dumenyuvasi_cam_0.geometry,material:I.material_5,position:[-.011,.299,3.441],rotation:[-Math.PI/2,0,1.571],scale:.094}),(0,o.jsx)("mesh",{geometry:M.dumenyuvasi_fiberglass_0.geometry,material:I.fiberglass,position:[-.011,.299,3.441],rotation:[-Math.PI/2,0,1.571],scale:.094}),(0,o.jsx)("mesh",{geometry:M.govde_fiberglass2_0.geometry,material:I.fiberglass2,position:[0,.32,-.897],rotation:[0,Math.PI/2,0],scale:[5.11,.454,1.212]}),(0,o.jsx)("mesh",{geometry:M.govde_fiberglass_0.geometry,material:I.fiberglass,position:[0,.32,-.897],rotation:[0,Math.PI/2,0],scale:[5.11,.454,1.212]}),(0,o.jsx)("mesh",{geometry:M.govde_metal_0.geometry,material:I.metal,position:[0,.32,-.897],rotation:[0,Math.PI/2,0],scale:[5.11,.454,1.212]}),(0,o.jsx)("mesh",{geometry:M.halattutucu_fiberglass2_0.geometry,material:I.fiberglass2,position:[-1.044,.939,1.809],rotation:[-Math.PI/2,0,0],scale:[.016,.059,.016]}),(0,o.jsx)("mesh",{geometry:M.ip001_metal_0.geometry,material:I.metal,position:[-.231,7.608,-.621],rotation:[-2.322,.222,-1.556],scale:[.007,.007,.011]}),(0,o.jsx)("mesh",{geometry:M.pervan_fiberglass_0.geometry,material:I.fiberglass,position:[0,-1.005,1.561],rotation:[-Math.PI/2,Math.PI/2,0],scale:[.154,.094,.104]}),(0,o.jsx)("mesh",{geometry:M.pervane_metal_0.geometry,material:I.metal,position:[0,-1.122,1.75],scale:.034}),(0,o.jsx)("mesh",{ref:g,geometry:M.rudder_fiberglass_0.geometry,material:I.fiberglass,position:[0,-1.153,3.486],rotation:[-Math.PI/2,Math.PI/2,0],scale:[.573,.262,.262]}),(0,o.jsx)("mesh",{geometry:M.salma_fiberglass_0.geometry,material:I.fiberglass,position:[0,-1.953,-.739],scale:[.149,.108,.756]}),(0,o.jsx)("mesh",{geometry:M.ustcam_cam_0.geometry,material:I.material_5,position:[-.337,.974,-3.127],rotation:[-Math.PI/2,0,0],scale:[-.183,.133,.025]}),(0,o.jsx)("mesh",{geometry:M.ustcam_fiberglass_0.geometry,material:I.fiberglass,position:[-.337,.974,-3.127],rotation:[-Math.PI/2,0,0],scale:[-.183,.133,.025]}),(0,o.jsx)("mesh",{geometry:M.ustgovde_fiberglass_0.geometry,material:I.fiberglass,position:[0,.832,-2.741],rotation:[-Math.PI/2,0,0],scale:[.566,.7,1.212]}),(0,o.jsx)("mesh",{geometry:M.ustgovdekzak_ahsap_0.geometry,material:I.ahsap,position:[0,.862,-2.741],rotation:[-Math.PI/2,0,0],scale:[.566,.7,1.212]}),(0,o.jsx)("mesh",{geometry:M.vinc_metal_0.geometry,material:I.metal,position:[-1.07,.977,2.02],rotation:[-Math.PI/2,0,0],scale:.065}),(0,o.jsx)("mesh",{geometry:M.yancam002_cam_0.geometry,material:I.material_5,position:[-.984,.591,-3.772],rotation:[Math.PI,-1.241,-Math.PI/2],scale:[.095,.28,.014]}),(0,o.jsx)("mesh",{geometry:M.yancam002_fiberglass_0.geometry,material:I.fiberglass,position:[-.984,.591,-3.772],rotation:[Math.PI,-1.241,-Math.PI/2],scale:[.095,.28,.014]}),(0,o.jsx)("mesh",{geometry:M.yankoruma_metal_0.geometry,material:I.metal,position:[-1.641,.946,2.868],rotation:[-Math.PI/2,0,0],scale:[.01,.01,.159]}),(0,o.jsx)("mesh",{geometry:M.yankoruma_metal_0001.geometry,material:I.metal,position:[-1.641,.946,2.868],rotation:[-Math.PI/2,0,0],scale:[.01,.01,.159]}),(0,o.jsx)("mesh",{geometry:M.yankoruma_metal_0002.geometry,material:I.metal,position:[-1.641,.946,2.868],rotation:[-Math.PI/2,0,0],scale:[.01,.01,.159]}),(0,o.jsx)("mesh",{geometry:M.zincir_metal_0.geometry,material:I.metal,position:[-.001,.88,-6.258],rotation:[-1.56,-.031,-.149],scale:.004}),(0,o.jsx)("mesh",{geometry:M.zincir_metal_0001.geometry,material:I.metal,position:[-.001,.88,-6.258],rotation:[-1.56,-.031,-.149],scale:.004}),(0,o.jsx)("mesh",{geometry:M.zincirdeposu_fiberglass2_0.geometry,material:I.fiberglass2,position:[0,.863,-5.779],rotation:[-Math.PI/2,0,0],scale:[.103,.088,.009]}),(0,o.jsx)("mesh",{geometry:M.zincirmakara_metal_0.geometry,material:I.metal,position:[0,.869,-6.305],rotation:[-2.159,1.564,.59],scale:[.01,.01,.016]}),(0,o.jsx)("mesh",{geometry:M.zincirray_ahsap_0.geometry,material:I.ahsap,position:[0,.864,-6.113],rotation:[-Math.PI/2,0,0],scale:[.017,.181,.003]})]}),Optimist:()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("mesh",{geometry:M.body_body_0.geometry,material:I.body,position:[-.054,.272,-.022],rotation:[-1.571,.01,.01],scale:[1,5.242,1]}),(0,o.jsx)("mesh",{geometry:M.boom_aluminium_0.geometry,material:I.aluminium,position:[-.019,2.771,.964],rotation:[0,.01,-.01],scale:[.15,.15,4.609]}),(0,o.jsx)("mesh",{geometry:M.rubber_joint__0.geometry,material:I.rubber_joint__0,position:[-.008,1.407,3.453],rotation:[1.571,-.01,-.01],scale:[-.037,.056,.079]}),(0,o.jsx)("mesh",{geometry:M.sail_sail_0.geometry,material:I.sail,position:[.038,8.739,.698],rotation:[2.356,1.557,2.356],scale:[-5.728,4.361,4.361]})]}),Ship:()=>(0,o.jsx)("mesh",{geometry:M.Object_10.geometry,material:I.material_0,position:[0,-.55,0],rotation:[-1.558,.002,3.139],scale:.004}),Windsurf:()=>(0,o.jsx)("mesh",{geometry:M["body_Material_#30_0"].geometry,material:I.Material_30,position:[-.007,0,-.071],rotation:[-Math.PI/2,0,0],scale:.002}),Sailboat:()=>(0,o.jsx)("mesh",{geometry:M.sailboat.geometry,material:I.texture,position:[0,-1.5,0],rotation:[-Math.PI,.011,-Math.PI],scale:.219})};return e[y.name]||e.Default},[y.name,M,I]);return(0,o.jsxs)("group",{...h,ref:c,dispose:null,children:[d.includes("sail")&&a&&(0,o.jsx)(b,{}),(0,o.jsx)(R,{})]})});n.L.preload(P(),"".concat(x,"/draco/")),I.displayName="SailBoat3D";var v=I}}]);