(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[890],{29927:function(e,n,t){var o={"./default/Scene.jsx":[42967,967],"./optimist/Scene.jsx":[96154,154],"./sailboat/Scene.jsx":[82274,274],"./ship/Scene.jsx":[75221,221],"./windsurf/Scene.jsx":[92975,975]};function a(e){if(!t.o(o,e))return Promise.resolve().then(function(){var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n});var n=o[e],a=n[0];return t.e(n[1]).then(function(){return t(a)})}a.keys=function(){return Object.keys(o)},a.id=29927,e.exports=a},10890:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return $}});var o=t(57437),a=t(2265),r=t(68328),i=t(44725),l=t(85903),s=t(5550),c=t(11909),u=t(21276),d=t(88345),g=t(72079),h=t(53082);let m=(0,d.g)({time:0,speed:1,scale:3,opacity:.5,color:new g.Ilk(7895160),foamColor:new g.Ilk(16777215),waterColor:new g.Ilk(26367),rainbowActive:0},"\n    varying vec2 vUv;\n    varying float vElevation;\n    \n    void main() {\n      vUv = uv;\n      \n      // Add subtle vertex displacement for a wavy effect.\n      float elevation = sin(position.x * 0.2 + position.y * 0.3) * 0.1;\n      vElevation = elevation;\n      vec3 newPosition = position + normal * elevation;\n      \n      gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n    }\n  ","\n    uniform float time;\n    uniform float speed;\n    uniform float scale;\n    uniform float opacity;\n    uniform vec3 color;\n    uniform vec3 foamColor;\n    uniform vec3 waterColor;\n    uniform float rainbowActive; // Controls whether the rainbow effect is applied.\n\n    varying vec2 vUv;\n    varying float vElevation;\n\n    // Standard noise functions.\n    vec4 permute(vec4 x) {\n      return mod(((x * 34.0) + 1.0) * x, 289.0);\n    }\n\n    vec2 fade(vec2 t) {\n      return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n    }\n\n    float cnoise(vec2 P) {\n      vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n      vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n      Pi = mod(Pi, 289.0);\n      vec4 ix = Pi.xzxz;\n      vec4 iy = Pi.yyww;\n      vec4 fx = Pf.xzxz;\n      vec4 fy = Pf.yyww;\n      vec4 i = permute(permute(ix) + iy);\n      vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0;\n      vec4 gy = abs(gx) - 0.5;\n      vec4 tx = floor(gx + 0.5);\n      gx = gx - tx;\n      vec2 g00 = vec2(gx.x, gy.x);\n      vec2 g10 = vec2(gx.y, gy.y);\n      vec2 g01 = vec2(gx.z, gy.z);\n      vec2 g11 = vec2(gx.w, gy.w);\n      vec4 norm = 1.79284291400159 - 0.85373472095314 *\n                  vec4(dot(g00, g00), dot(g10, g10), dot(g01, g01), dot(g11, g11));\n      g00 *= norm.x;\n      g10 *= norm.y;\n      g01 *= norm.z;\n      g11 *= norm.w;\n      float n00 = dot(g00, vec2(fx.x, fy.x));\n      float n10 = dot(g10, vec2(fx.y, fy.y));\n      float n01 = dot(g01, vec2(fx.z, fy.z));\n      float n11 = dot(g11, vec2(fx.w, fy.w));\n      vec2 fade_xy = fade(Pf.xy);\n      vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n      float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n      return 2.3 * n_xy;\n    }\n\n    // HSL to RGB conversion function.\n    vec3 hsl2rgb(vec3 hsl) {\n      vec3 rgb = clamp(abs(mod(hsl.x * 6.0 + vec3(0.0, 4.0, 2.0), 6.0) - 3.0) - 1.0,\n                       0.0, 1.0);\n      rgb = rgb * rgb * (3.0 - 2.0 * rgb);\n      return hsl.z + hsl.y * (rgb - 0.5) * (1.0 - abs(2.0 * hsl.z - 1.0));\n    }\n\n    void main() {\n      // Combine multiple layers of noise to build a complex water pattern.\n      float baseNoise = cnoise(vUv * scale + vec2(time * speed, 0.0));\n      float detailNoise = cnoise(vUv * scale * 2.0 + vec2(time * speed * 1.5, 0.0)) * 0.5;\n      float turbulence = cnoise(vUv * scale * 4.0 + vec2(time * speed * 2.0, 0.0)) * 0.25;\n      float noise = baseNoise + detailNoise + turbulence;\n      \n      // Create a wake pattern.\n      float wake = smoothstep(0.3, 0.7, 1.0 - abs(vUv.x - 0.5) * 2.0);\n      \n      // Create a foam effect.\n      float foam = smoothstep(0.4, 0.6, noise + wake);\n      \n      // Mix water and foam colors, then blend in the base color.\n      vec3 finalColor = mix(waterColor, foamColor, foam);\n      finalColor = mix(finalColor, color, wake * 0.5);\n      \n      // Adjust dynamic opacity.\n      float alpha = opacity * (wake + foam * 0.5) * (1.0 - vUv.y);\n      \n      // Add wave highlights.\n      float highlight = smoothstep(0.2, 0.4, noise + wake) *\n                        (1.0 - smoothstep(0.4, 0.6, noise + wake));\n      finalColor += highlight * foamColor * 0.5;\n      \n      // --- Rainbow Effect ---\n      // When rainbowActive is enabled, overlay a dynamic rainbow gradient.\n      if (rainbowActive > 0.5) {\n        // Cycle the hue based on the horizontal UV and time.\n        float rainbowHue = mod(vUv.x + time * 0.5, 1.0);\n        vec3 rainbowColor = hsl2rgb(vec3(rainbowHue, 1.0, 0.5));\n        // Blend the rainbow with the original finalColor.\n        finalColor = mix(finalColor, rainbowColor, 0.7);\n      }\n      \n      gl_FragColor = vec4(finalColor, alpha);\n    }\n  ");(0,u.e)({TrailShaderMaterial:m});let f=e=>{let{color:n="#787878",waterColor:t="#0066ff",foamColor:r="#ffffff",speed:i=1,scale:l=3,opacity:s=.5}=e,c=(0,a.useRef)(),{getSignalKValue:d}=(0,h.yC)();return(0,u.F)((e,n)=>{if(c.current){c.current.uniforms.time.value+=n;let e="auto"==d("steering.autopilot.state");c.current.uniforms.rainbowActive.value=e?1:0}}),(0,o.jsxs)("mesh",{rotation:[-Math.PI/2,0,Math.PI/2],position:[0,0,22.5],children:[(0,o.jsx)("planeGeometry",{args:[40,2.2,128,32]}),(0,o.jsx)("trailShaderMaterial",{ref:c,color:new g.Ilk(n),waterColor:new g.Ilk(t),foamColor:new g.Ilk(r),speed:i,scale:l,opacity:s,transparent:!0,depthWrite:!1,blending:g.WMw})]})};var v=t(54752),p=t(33866),x=t(79257);(0,u.e)({Water:v.B,Sky:p.q});var M=function(){let{nightMode:e}=(0,h.yC)(),n=(0,a.useRef)(),t=(0,a.useRef)(),r=(0,a.useRef)(),i=(0,u.D)(e=>e.gl),l=(0,u.D)(e=>e.scene),s=(0,a.useMemo)(()=>new g.Pa4,[]),c=(0,x.mE)("assets/moon.jpg"),d=(0,u.H)(g.dpR,"assets/waternormals.jpg");(0,a.useMemo)(()=>{d.wrapS=d.wrapT=g.rpg},[d]);let m=(0,a.useMemo)(()=>new g._12(5e3,5e3,32,32),[]),f=(0,a.useMemo)(()=>({textureWidth:256,textureHeight:256,waterNormals:d,sunDirection:new g.Pa4,sunColor:e?12642559:16777215,waterColor:e?6702:30668,distortionScale:2,format:i.encoding,reflectivity:0}),[d,i.encoding,e]);(0,u.F)(()=>{let o=e?45:2,a=e?30:180;if(t.current){let r=t.current.material.uniforms;e?(r.turbidity.value=.2,r.rayleigh.value=.5,r.mieCoefficient.value=.01,r.mieDirectionalG.value=.8):(r.turbidity.value=1,r.rayleigh.value=1,r.mieCoefficient.value=.003,r.mieDirectionalG.value=.5);let i=g.M8C.degToRad(90-o),l=g.M8C.degToRad(a);s.setFromSphericalCoords(1,i,l),r.sunPosition.value.copy(s),n.current&&n.current.material.uniforms.sunDirection.value.copy(s).normalize()}},[]),(0,a.useEffect)(()=>(e?l.background=new g.Ilk(2068):l.background=new g.Ilk(8900331),()=>{l.background=null,l.environment=null}),[l,e]);let v=0;return(0,u.F)((e,t)=>{(v+=t)>.1&&(n.current&&(n.current.material.uniforms.time.value+=.5*v),v=0)}),(0,o.jsxs)(o.Fragment,{children:[!e&&(0,o.jsx)("sky",{ref:t,scale:1e4}),e&&(0,o.jsxs)("mesh",{ref:r,position:[600,200,-1500],children:[(0,o.jsx)("sphereGeometry",{args:[80,32,32]}),(0,o.jsx)("meshStandardMaterial",{map:c,emissive:16777215,emissiveIntensity:.8})]}),(0,o.jsx)("water",{ref:n,args:[m,f],"rotation-x":-Math.PI/2,position:[0,-.5,0]})]})},w=t(14578),y=t(63321);let b=(0,a.createContext)(),j=()=>(0,a.useContext)(b),P=(e,n,t,o)=>{let a=t.split(".").reduce((e,n)=>null==e?void 0:e[n],o);void 0!==a&&(e[n]=a)},C=e=>{let{children:n}=e,[t,r]=(0,a.useState)({}),[i,l]=(0,a.useState)([]),s=(0,a.useRef)(null),c=(0,a.useRef)({});return(0,a.useEffect)(()=>{let e=async e=>{console.log("Fetching static vessel information...");try{let n=await e.API().then(e=>e.vessels()),t=Object.entries(n).map(e=>{let[n,t]=e,o={mmsi:n};return P(o,"name","name",t),P(o,"latitude","navigation.position.value.latitude",t),P(o,"longitude","navigation.position.value.longitude",t),P(o,"sog","navigation.speedOverGround.value",t),P(o,"cog","navigation.courseOverGroundTrue.value",t),P(o,"cogMagnetic","navigation.courseOverGroundMagnetic.value",t),P(o,"heading","navigation.headingTrue.value",t),P(o,"headingMagnetic","navigation.headingMagnetic.value",t),P(o,"length","design.length.value.overall",t),P(o,"beam","design.beam.value",t),P(o,"callsign","communication.callsignVhf",t),P(o,"shipType","design.aisShipType.value.id",t),o.lastUpdate=Date.now(),o});console.log("Fetched ".concat(t.length," vessels.")),l(t);let o={};t.forEach(e=>{e.mmsi&&(null!==e.latitude||null!==e.longitude)&&(o[e.mmsi]=e)}),Object.keys(o).length>0&&(console.log("Initializing AIS data with ".concat(Object.keys(o).length," vessels")),r(o))}catch(e){console.error("Error fetching static vessel info:",e)}},n=e=>{if(!(null==e?void 0:e.updates)){console.warn("Delta is missing or does not contain updates:",e);return}let n=e=>({mmsi:e,name:"unknown",latitude:null,longitude:null,sog:null,cog:null,cogMagnetic:null,heading:null,headingMagnetic:null}),t=e.context.replace("vessels.","");if(!t){console.warn("Update missing MMSI context:",e);return}c.current[t]=Date.now(),r(o=>{let a=o[t]||n(t);return a.lastUpdate=c.current[t],e.updates.forEach(e=>{e.values.forEach(e=>{switch(e.path){case"name":a.name=e.value;break;case"navigation.position":a.latitude=e.value.latitude,a.longitude=e.value.longitude;break;case"navigation.speedOverGround":a.sog=e.value;break;case"navigation.courseOverGroundTrue":a.cog=e.value;break;case"navigation.courseOverGroundMagnetic":a.cogMagnetic=e.value;break;case"navigation.headingTrue":a.heading=e.value;break;case"navigation.headingMagnetic":a.headingMagnetic=e.value}})}),{...o,[t]:a}})};return(async()=>{try{let{signalkUrl:t}=y.Z.getAll();if(console.log("SignalK URL:",t),!t)throw Error("SignalK URL is undefined or invalid.");let[o,a]=t.replace(/https?:\/\//,"").split(":");console.log("Connecting to SignalK at hostname: ".concat(o,", port: ").concat(a));let r=new w.default({hostname:o||"localhost",port:parseInt(a)||3e3,useTLS:t.startsWith("https"),reconnect:!0,autoConnect:!1,notifications:!1,subscriptions:[{context:"vessels.*",subscribe:[{path:"navigation.position"},{path:"navigation.speedOverGround"},{path:"navigation.courseOverGroundTrue"},{path:"navigation.courseOverGroundMagnetic"},{path:"navigation.headingTrue"},{path:"navigation.headingMagnetic"}]}]});s.current=r,await r.connect(),console.log("SignalK client connected."),await e(r),r.on("delta",n)}catch(e){console.error("Error connecting to SignalK:",e)}})(),()=>{var e;console.log("Disconnecting SignalK client..."),null===(e=s.current)||void 0===e||e.disconnect()}},[]),(0,o.jsx)(b.Provider,{value:{aisData:t,vesselIds:i},children:n})};var I=t(45476);let S=async e=>{try{let n=await t(29927)("./".concat(e,"/Scene.jsx"));return n.default?n.default:n.Model}catch(n){throw console.error("Error loading ".concat(e," component:"),n),n}},R=e=>0===e?"windsurf":30===e?"optimist":36===e?"sailboat":"ship",E=(0,a.forwardRef)((e,n)=>{let{position:t,visible:r,boatData:i,onHover:l}=e,[s,c]=(0,a.useState)(null),u=R(i.shipType);if((0,a.useEffect)(()=>{let e=!0;return S(u).then(n=>{e&&c(()=>n)}).catch(e=>console.error("Failed to load ".concat(u,":"),e)),()=>{e=!1}},[u]),!s)return null;let d=[i.name?function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=null!=n?"".concat(n).concat(t):"N/A";return"".concat(e,": ").concat(o,"\n")}("Name",i.name,""):"MMSI ".concat(i.mmsi.replace("urn:mrn:imo:mmsi:",""),"\n")].join(""),g=Math.max(i.length||10,4)/10;return(0,o.jsxs)("group",{ref:n,position:t,visible:r,children:[(0,o.jsx)("group",{onClick:e=>{e.stopPropagation(),s&&l&&l(i),console.log("Clicked on boat:",i.name||i.mmsi)},children:(0,o.jsx)(s,{scale:[g,g,g]})}),(0,o.jsx)("group",{position:[1.5,4,0],children:(0,o.jsx)(I.x,{position:[0,0,0],fontSize:.4,maxWidth:3,lineHeight:1.2,textAlign:"left",color:"white",anchorX:"center",anchorY:"middle",font:"fonts/Roboto-Bold.ttf",renderOrder:1e3,depthTest:!1,children:d})})]})});E.displayName="AISBoat";let O=e=>{if(e.material)return e;for(let n of e.children){let e=O(n);if(e)return e}return null},T=(e,n,t,o)=>void 0===e||void 0===n||void 0===t||void 0===o?{x:0,y:0}:{x:-(Math.PI/180*(n-o)*6371e3)*Math.cos(Math.PI/180*t),y:Math.PI/180*(e-t)*6371e3},_=(e,n)=>{let t=y.Z.get("aisLengthScalingFactor")||.7;if(null!=e.sog&&null!=e.cog){let o=.51444*e.sog;return{deltaX:o*n*Math.sin(e.cog*Math.PI/180)*t,deltaY:o*n*Math.cos(e.cog*Math.PI/180)*t}}return{deltaX:0,deltaY:0}},k=function(e,n,t){let o=!(arguments.length>3)||void 0===arguments[3]||arguments[3],a=y.Z.get("aisLengthScalingFactor")||.7,r=n*a,i=t*a;o?(e.position.x+=(r-e.position.x)*.1,e.position.z+=(i-e.position.z)*.1):e.position.set(r,0,i)},N=function(e,n){let t=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=-n*Math.PI/180%(2*Math.PI);t?e.children[0].rotation.y=e.children[0].rotation.y+(o-e.children[0].rotation.y)*.1:e.children[0].rotation.y=o,e.mmsi&&1>Math.abs(n%45)&&console.log("Boat ".concat(e.mmsi," rotation: ").concat(n,"\xb0 (").concat(o," rad)"))};var A=e=>{let{onUpdateInfoPanel:n}=e,{aisData:t,vesselIds:r}=j(),i=(0,a.useRef)({}),l=(0,a.useRef)(null),{getSignalKValue:s}=(0,h.yC)(),[c,d]=(0,a.useState)(null),g=(0,a.useRef)(0),m=()=>y.Z.get("aisLengthScalingFactor")||.7,f=500*m(),v=550*m(),p=3e3*m();(0,a.useRef)(!1),(0,u.F)(()=>{let e=s("navigation.position"),n=s("navigation.speedOverGround"),o=s("navigation.headingTrue")||s("navigation.headingMagnetic"),a=s("navigation.courseOverGroundTrue")||s("navigation.courseOverGroundMagnetic"),r=(a?180/Math.PI*a:null)||(o?180/Math.PI*o:null)||0;if(g.current=r,0!==r&&console.log("My boat rotation angle: ".concat(r.toFixed(1),"\xb0 (converted from ").concat((r*Math.PI/180).toFixed(2)," radians)")),l.current=e,!(null==e?void 0:e.latitude)||!(null==e?void 0:e.longitude)||!Object.keys(i.current).length)return;let c=performance.now();Object.values(t).forEach(t=>{if(null==t.latitude||null==t.longitude||!i.current[t.mmsi])return;let o=i.current[t.mmsi];if(!o)return;let a=t.lastUpdate||c,{x:r,y:l}=T(t.latitude,t.longitude,e.latitude,e.longitude),s=0,u=0;null!=n&&n>0&&c-a>1e3&&({deltaX:s,deltaY:u}=_(t,(c-a)/1e3));let d=r+s,h=l+u,x=Math.sqrt((d*m())**2+(h*m())**2);if(0===d&&0===h){o.visible=!1;return}if(x>0&&x<=p){o.visible=!0,o.currentColor||(o.currentColor=x<f?"red":"white");let e=o.currentColor;"red"===o.currentColor&&x>v?e="white":"white"===o.currentColor&&x<f&&(e="red"),k(o,d,h,!0);let n=null!==t.cog?180/Math.PI*t.cog:null!==t.cogMagnetic?180/Math.PI*t.cogMagnetic:null,a=null!==t.heading?180/Math.PI*t.heading:null!==t.headingMagnetic?180/Math.PI*t.headingMagnetic:null,r=null!==n?n:null!==a?a:0,i=r-g.current;o.mmsi&&Math.abs(r-(o.lastLoggedAngle||0))>10&&(console.log("Boat ".concat(o.mmsi," - Absolute angle: ").concat(r.toFixed(1),"\xb0, Relative: ").concat(i.toFixed(1),"\xb0")),o.lastLoggedAngle=r),N(o,i,!0);let l=O(o.children[0]);l?(o.redMaterial||(o.redMaterial=l.material.clone(),o.redMaterial.color.set("red")),o.whiteMaterial||(o.whiteMaterial=l.material.clone(),o.whiteMaterial.color.set("white")),"red"===e&&"red"!==o.currentMaterial?(l.material=o.redMaterial,o.currentMaterial="red",console.log("Swapped material to red for boat ".concat(t.mmsi))):"white"===e&&"white"!==o.currentMaterial&&(l.material=o.whiteMaterial,o.currentMaterial="white",console.log("Swapped material to white for boat ".concat(t.mmsi))),o.currentColor=e):console.warn("Material not found for boat ".concat(t.mmsi))}else o.visible=!1})});let x=(0,a.useMemo)(()=>{let e=l.current;return(null==e?void 0:e.latitude)&&(null==e?void 0:e.longitude)?r.filter(e=>{if(!e.mmsi||e.mmsi.startsWith("urn:mrn:signalk:uuid:")||e.mmsi.startsWith("227925790")||e.mmsi.startsWith("urn:mrn:imo:mmsi:230035780"))return!1;let n=t[e.mmsi];return!!n&&null!==n.latitude&&null!==n.longitude}).map(n=>{let a=t[n.mmsi],r=T(a.latitude,a.longitude,e.latitude,e.longitude);if(0===r.x&&0===r.y)return!1;let l=y.Z.get("aisLengthScalingFactor")||.7,s=r.x*l,u=r.y*l,g=Math.sqrt(s*s+u*u)<=p;return(0,o.jsx)(E,{ref:e=>{e&&(e.mmsi=n.mmsi,i.current[n.mmsi]=e)},position:[s,0,u],visible:g,boatData:{...n,...a},onHover:e=>{c&&e&&c.mmsi===e.mmsi?d(null):d(e)}},n.mmsi)}):[]},[r,t,p,c]),M=function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return null==n||""===n||"string"==typeof n&&0===n.trim().length?null:(o&&(n=Math.abs(n)<=2*Math.PI?Math.round((180*n/Math.PI+360)%360):Math.round(n)),"".concat(e,": ").concat(n).concat(t))},w=c?[M("Name",c.name),M("MMSI",(e=>{if(!e)return null;let n=e;for(let e of["urn:mrn:imo:mmsi:","urn:mrn:signalk:uuid:"])if(n.startsWith(e)){n=n.substring(e.length);break}return n})(c.mmsi)),M("Distance",(e=>{if(!e||!l.current)return null;let n=l.current;if(!(null==n?void 0:n.latitude)||!(null==n?void 0:n.longitude)||!e.latitude||!e.longitude)return null;let{x:t,y:o}=T(e.latitude,e.longitude,n.latitude,n.longitude);return Math.round(Math.sqrt(t*t+o*o)/1852*10)/10})(c)," NM"),M("Length",c.length,"m"),M("Type",c.shipType),M("SOG",c.sog," kts"),M("COG",c.cog,"\xb0",!0),M("Heading",c.heading,"\xb0",!0),M("Beam",c.beam,"m"),M("Draft",c.draft,"m"),M("Callsign",c.callsign),M("Destination",c.destination)].filter(e=>null!==e).join("\n"):"";return a.useEffect(()=>{n&&n(w)},[c,w,n]),(0,o.jsxs)(o.Fragment,{children:[x,c&&(0,o.jsx)("group",{position:[0,1,0],children:(0,o.jsxs)("mesh",{scale:[.1,.1,.1],visible:!1,children:[(0,o.jsx)("boxGeometry",{}),(0,o.jsx)("meshBasicMaterial",{color:"yellow"})]})})]})},F=t(1);let G=a.memo(e=>{let{radius:n,isOuter:t,markerColorPrimary:r,markerColorGreen:i,markerColorRed:l}=e,s=(0,a.useMemo)(()=>{let e=[];for(let a=0;a<360;a+=10){let s=g.M8C.degToRad(a-90),c=a%30==0,u=t?c?.4:.2:c?.3:.15,d=(n+.5*u+.2)*Math.cos(s),h=(n+.5*u+.2)*Math.sin(s),m=t&&a>0&&a<61,f=t&&a>=300&&a<360,v=m?i:f?l:r;if(!t&&c){let n=0===a?"N":a.toString();e.push((0,o.jsx)(I.x,{characters:"N0123456789",position:[d,.01,h],color:r,fontSize:.5,rotation:[-Math.PI/2,0,Math.PI/2-s],font:"fonts/Roboto-Bold.ttf",anchorY:"middle",children:n},"text-".concat(a)))}else e.push((0,o.jsx)(F.aL,{args:[u/2,16,16],position:[d,0,h],children:(0,o.jsx)("meshBasicMaterial",{color:v})},"marker-".concat(t?"outer":"inner","-").concat(a)))}return e},[n,t,r,i,l]);return(0,o.jsx)(o.Fragment,{children:s})});G.displayName="StaticMarkers";let D=a.memo(e=>{let{innerRadius:n,outerRadius:t,dialColor:a,opacity:r=1,transparent:i=!1}=e;return(0,o.jsx)(F.FM,{args:[n,t,64],rotation:[Math.PI/2,0,0],children:(0,o.jsx)("meshBasicMaterial",{color:a,side:g.ehD,transparent:i,opacity:r})})});D.displayName="StaticRing";let L=e=>{let{outerRadius:n,innerRadius:t}=e,r=h.FV,i=h.HH,{nightMode:l,getSignalKValue:s}=(0,h.yC)(),c=l?h.eF:16777215,u=s("navigation.headingTrue")||s("navigation.headingMagnetic"),d=s("navigation.courseOverGroundTrue")||s("navigation.courseOverGroundMagnetic"),g=(0,a.useMemo)(()=>({innerRadius:t,outerRadius:n,dialColor:c,markerColorPrimary:0,markerColorGreen:r,markerColorRed:i}),[t,n,c,0,r,i]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("group",{rotation:[0,(d||u||0)+Math.PI,0],children:[(0,o.jsx)(D,{innerRadius:g.innerRadius,outerRadius:g.outerRadius,dialColor:g.dialColor}),(0,o.jsx)(G,{radius:g.innerRadius,isOuter:!1,markerColorPrimary:g.markerColorPrimary,markerColorGreen:g.markerColorGreen,markerColorRed:g.markerColorRed})]}),(0,o.jsxs)("group",{children:[(0,o.jsx)(D,{innerRadius:g.innerRadius+1,outerRadius:g.outerRadius+1,dialColor:g.dialColor,transparent:!0,opacity:.5}),(0,o.jsx)(G,{radius:g.innerRadius+1,isOuter:!0,markerColorPrimary:g.markerColorPrimary,markerColorGreen:g.markerColorGreen,markerColorRed:g.markerColorRed})]})]})};L.displayName="CompassDial";var U=t(95723),z=()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(L,{outerRadius:5.6,innerRadius:5}),(0,o.jsx)(U.Z,{outerRadius:5.6+1.1})]}),H=t(58181),W=JSON.parse('{"N":{"52":[4.98,5.86,6.31,6.45,6.51,6.52,6.41],"60":[5.25,6.11,6.56,6.73,6.79,6.82,6.79],"75":[5.45,6.33,6.77,7.01,7.13,7.2,7.24],"90":[5.66,6.55,7,7.25,7.38,7.53,7.7],"110":[5.49,6.49,7.04,7.4,7.69,7.97,8.38],"120":[5.32,6.36,6.97,7.39,7.77,8.1,8.6],"135":[4.81,5.92,6.68,7.15,7.55,7.95,8.85],"150":[4.09,5.17,6.04,6.61,6.99,7.31,7.93],"angles":[52,60,75,90,110,120,135,150],"speeds":[6,8,10,12,14,16,20],"beat_angle":[43.6,42,41.2,41.2,41.7,42.1,44.2],"beat_vmg":[3.26,3.91,4.24,4.34,4.36,4.34,4.16],"run_angle":[144.8,147.8,148.5,149.6,171.8,175.4,177.2],"run_vmg":[3.54,4.48,5.23,5.73,6.17,6.67,7.36]}}');let B={DEG2RAD:Math.PI/180,ROTATION_INTERPOLATION_FACTOR:.05,SOG_SMOOTHING_FACTOR:.1,DEFAULT_SOG:3,ANGLE_INCREMENT:10,SPHERE_SIZE:.4,SPHERE_SEGMENTS:32,DEFAULT_LINE_WIDTH:1,PLOTS_COUNT:5,FRAME_TO_MINUTE_RATIO:3600},Z=(e,n)=>26.8224*e*n*.1,q=(e,n,t)=>{if(!e||!n)return new g.Pa4(0,0,0);let o=e*B.DEG2RAD,a=Z(n,t);return new g.Pa4(a*Math.sin(o),0,-a*Math.cos(o))},K=(e,n)=>{if(!(null==e?void 0:e.length))return 0;let t=0,o=e.length-1;for(;t<o;){let a=Math.floor((t+o)/2);e[a]<n?t=a+1:o=a}return t},V=e=>{let{position:n,color:t}=e;return n?(0,o.jsxs)("mesh",{position:n,children:[(0,o.jsx)("sphereGeometry",{args:[B.SPHERE_SIZE,B.SPHERE_SEGMENTS,B.SPHERE_SEGMENTS]}),(0,o.jsx)("meshStandardMaterial",{color:t})]}):null},Y=e=>{let{points:n,color:t}=e;return(null==n?void 0:n.length)?(0,o.jsx)(H.x,{points:n,color:t,lineWidth:B.DEFAULT_LINE_WIDTH}):null},X=a.memo(e=>{let{timeInMinute:n,windSpeed:t}=e,r=(0,a.useRef)(W.N),i=(0,a.useCallback)((e,n,t,o)=>{if(!(null==e?void 0:e.length)||!(null==n?void 0:n.length)||e.length<=t||n.length<=t)return console.warn("Invalid angle or VMG data"),null;let a=e[t],r=n[t],i=a*B.DEG2RAD,l=Z(r,o);return new g.Pa4(l*Math.sin(i),0,-l*Math.cos(i))},[]),l=(0,a.useCallback)((e,n)=>{let{speeds:t,angles:o,beat_angle:a,beat_vmg:i,run_angle:l,run_vmg:s}=r.current;if(!(null==t?void 0:t.length)||!(null==o?void 0:o.length))return console.warn("Invalid polar data"),null;let c=(e,n,t)=>e+t*(n-e),u=[],d=(e,t,o)=>{for(let a=e;a<=t;a+=B.ANGLE_INCREMENT)u.push(q(a,o(a),n))};d(0,a[e]-B.ANGLE_INCREMENT,n=>c(0,i[e],n/a[e]));let h=q(a[e],i[e],n);u.push(h),o.forEach(t=>{if(t>a[e]&&t<l[e]){var o;let a=(null===(o=r.current[Math.floor(t)])||void 0===o?void 0:o[e])||0;u.push(q(t,a,n))}});let m=q(l[e],s[e],n);return u.push(m),d(l[e]+B.ANGLE_INCREMENT,180,()=>s[e]),new g.YT8(u,!0)},[]),s=(0,a.useMemo)(()=>{var e;let o=r.current;if(!(null==o?void 0:null===(e=o.speeds)||void 0===e?void 0:e.length))return console.warn("Invalid polar data structure"),{curve:null,beat:null,run:null};let a=K(o.speeds,t);return{curve:l(a,n),beat:i(o.beat_angle,o.beat_vmg,a,n),run:i(o.run_angle,o.run_vmg,a,n)}},[n,t,i,l]);return(0,o.jsx)(o.Fragment,{children:[0,-Math.PI].map((e,n)=>(0,o.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,e],children:[s.curve&&(0,o.jsx)(Y,{points:s.curve.getPoints(100),color:h.gK}),(0,o.jsx)(V,{position:s.beat,color:h.FV}),(0,o.jsx)(V,{position:s.run,color:h.HH})]},n))})});X.displayName="PolarPlot";var Q=function(){let e=(0,a.useRef)([]),[n,t]=(0,a.useState)([]),r=(0,a.useRef)(0),i=(0,a.useRef)([]),l=(0,a.useRef)(B.DEFAULT_SOG),{getSignalKValue:s}=(0,h.yC)(),c=-s("environment.wind.angleApparent"),d=(0,h.HQ)(s("environment.wind.speedOverGround"))||0,m=s("navigation.speedOverGround")||B.DEFAULT_SOG,f=(0,a.useRef)(d),[v,p]=(0,a.useState)(Date.now()),x=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let n=Array.from({length:B.PLOTS_COUNT},(e,n)=>({id:n,timeInMinute:5*(n+1)}));return t(n),e.current=n.map(()=>new g.ZAu),i.current=Array(B.PLOTS_COUNT).fill(0),x.current=setInterval(()=>{p(Date.now()),r.current=0,console.log("Forcing redraw of polar plots")},12e4),()=>{x.current&&clearInterval(x.current)}},[]),(0,a.useEffect)(()=>{Math.abs(f.current-d)>5&&(console.log("Wind speed changed from ".concat(f.current," to ").concat(d,", recreating polar curves")),p(Date.now()),r.current=0,f.current=d)},[d]),(0,u.F)((t,o)=>{r.current+=1,l.current=g.M8C.lerp(l.current,m,B.SOG_SMOOTHING_FACTOR),n.forEach((n,t)=>{let o=e.current[t];if(o&&n.timeInMinute-r.current/B.FRAME_TO_MINUTE_RATIO>0){let e=i.current[t],n=g.M8C.lerp(e,c,B.ROTATION_INTERPOLATION_FACTOR);o.rotation.set(0,n,0),i.current[t]=n}})}),(0,o.jsx)(o.Fragment,{children:n.map((n,t)=>(0,o.jsx)("group",{ref:n=>{n&&(e.current[t]=n)},children:(0,o.jsx)(X,{timeInMinute:n.timeInMinute,windSpeed:d},"plot-".concat(v,"-").concat(t))},"".concat(n.id,"-").concat(v)))})},J=()=>{let{states:e,nightMode:n}=(0,h.yC)(),t=n?.2:.4;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("ambientLight",{intensity:n?.3:.5}),(0,o.jsx)("directionalLight",{position:[0,70,-100],intensity:n?.8:1.4,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-near":.5,"shadow-camera-far":200,"shadow-camera-left":-50,"shadow-camera-right":50,"shadow-camera-top":50,"shadow-camera-bottom":-50,"shadow-bias":-.0001,color:n?"#c8e6ff":"#ffffff"}),(0,o.jsx)("pointLight",{position:[0,40,-80],intensity:2.5*t,distance:150,decay:2}),(0,o.jsx)("pointLight",{position:[0,30,100],intensity:.8*t,distance:120,decay:2})]})},$=e=>{let{onUpdateInfoPanel:n}=e,{states:t,getSignalKValue:u}=(0,h.yC)();y.Z.getAll();let d=(0,a.useRef)();return(0,o.jsxs)(a.Suspense,{fallback:(0,o.jsx)(r.V,{children:"Loading..."}),children:[(0,o.jsx)(i.c,{makeDefault:!0,fov:60,near:5,far:500,position:[0,5,20]}),(0,o.jsx)(l.z,{enableZoom:!0,enableRotate:!0,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/4,enableDamping:!1,zoomSpeed:.5,rotateSpeed:.5}),(0,o.jsx)(s.qA,{files:"./assets/ocearo_env.hdr",background:!1,intensity:.8,resolution:256}),(0,o.jsx)(J,{}),(0,o.jsxs)("group",{position:[0,-3,0],children:[(0,o.jsx)(c.Z,{position:[0,0,.7],scale:[.7,.7,.7],ref:d,showSail:!0,onUpdateInfoPanel:n}),t.showOcean&&(0,o.jsx)(M,{}),(0,o.jsx)(f,{}),t.showPolar&&!t.showOcean&&(0,o.jsx)(Q,{}),t.ais&&(0,o.jsx)(C,{children:(0,o.jsx)(A,{onUpdateInfoPanel:n})}),(0,o.jsx)(z,{visible:!1})]})]})}},95723:function(e,n,t){"use strict";var o=t(57437),a=t(2265),r=t(40718),i=t.n(r),l=t(53082),s=t(72079),c=t(45476);let u={TRUE_WIND:1,APP_WIND:1},d=e=>{let{position:n=[0,0,0],rotation:t=[0,0,0],speed:a,color:r="#ffffff",fontSize:i=.5,textPosition:l=[0,.8,0],arrowSize:u=1}=e;return(0,o.jsxs)("group",{position:n,rotation:t,children:[(0,o.jsx)(c.x,{characters:".0123456789",color:r,fontSize:i*u,position:l,font:"fonts/Roboto-Bold.ttf",anchorX:"center",anchorY:"middle",children:a.toFixed(1)}),(0,o.jsxs)("mesh",{children:[(0,o.jsx)("shapeGeometry",{args:[new s.bnF([new s.FM8(0,0),new s.FM8(.5*u*Math.cos(5*Math.PI/6),.5*u*Math.sin(5*Math.PI/6)),new s.FM8(0,-.577*u),new s.FM8(-.5*u*Math.cos(5*Math.PI/6),.5*u*Math.sin(5*Math.PI/6)),new s.FM8(0,0)])]}),(0,o.jsx)("meshStandardMaterial",{color:r,side:s.ehD})]})]})};d.propTypes={position:i().oneOfType([i().instanceOf(s.Pa4),i().arrayOf(i().number)]).isRequired,rotation:i().arrayOf(i().number).isRequired,speed:i().number.isRequired,color:i().oneOfType([i().string,i().number]).isRequired,fontSize:i().number,textPosition:i().arrayOf(i().number),arrowSize:i().number};let g=e=>{let{outerRadius:n}=e,{getSignalKValue:t}=(0,l.yC)(),r=Math.PI/2-t("environment.wind.angleTrueGround")||0,i=(0,l.HQ)(t("environment.wind.speedOverGround"))||0,c=Math.PI/2-t("environment.wind.angleApparent")||0,g=(0,l.HQ)(t("environment.wind.speedApparent"))||0,h=(0,a.useMemo)(()=>new s.Pa4((n+.7)*Math.cos(r),0,-(n+.7)*Math.sin(r)),[n,r]),m=(0,a.useMemo)(()=>new s.Pa4((n+.7)*Math.cos(c),0,-(n+.7)*Math.sin(c)),[n,c]);return(0,o.jsxs)("group",{children:[i>0&&(0,o.jsx)(d,{position:h,rotation:[-Math.PI/2,0,-(Math.PI/2-r)],speed:i,color:"#0000FF",fontSize:u.TRUE_WIND}),g>0&&(0,o.jsx)(d,{position:m,rotation:[-Math.PI/2,0,-(Math.PI/2-c)],speed:g,color:l.gK,fontSize:u.APP_WIND})]})};g.propTypes={outerRadius:i().number.isRequired},n.Z=g}}]);